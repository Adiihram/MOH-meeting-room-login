<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPP Meeting Room Booking - Version 4.8</title>
    <link href="https://unpkg.com/fullcalendar@6.1.15/main.min.css" rel="stylesheet">
    <script src="https://unpkg.com/fullcalendar@6.1.15/main.min.js"></script>
    <script src="https://unpkg.com/firebase@8.10.0/firebase-app.js"></script>
    <script src="https://unpkg.com/firebase@8.10.0/firebase-database.js"></script>    
    <style>
        /* Your existing CSS styles here */
        /* ... */
    </style>
</head>
<body>
    <div class="container">
        <div id="sidebar" class="sidebar">
            <h2>Analytics</h2>
            <!-- Your sidebar content here -->
        </div>
        <div id="main-content">
            <h1>DPP Meeting Room Booking - Version 4.8</h1>
            <div id="calendar"></div>        
        </div>
    </div>
    <button id="logoutButton">Logout</button>
    
    <div id="bookingForm" class="booking-form" style="display: none;">
        <!-- Your booking form content here -->
    </div>

    <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAED2NeWY224WpucUIFIef6Ekm7lUufM0o",
        authDomain: "moh-meeting-room-booking.firebaseapp.com",
        databaseURL: "https://moh-meeting-room-booking-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "moh-meeting-room-booking",
        storageBucket: "moh-meeting-room-booking.appspot.com",
        messagingSenderId: "629503206549",
        appId: "1:629503206549:web:4b172b7f392b7aef0de79c",
        measurementId: "G-MDSDN8ZS5F"
    };

    function corsProxy(url) {
        return 'https://cors-anywhere.herokuapp.com/' + url;
    }    

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp({
            ...firebaseConfig,
            databaseURL: corsProxy(firebaseConfig.databaseURL)
        });
    } else {
        firebase.app();
    }

    // Get a reference to the database service
    const db = firebase.database();

    let calendar;
    let selectedDate;

    // Customizable Islamic month names
    const islamicMonths = [
        "Muharram", "Safar", "Rabiulaawal", "Rabiulakhir",
        "Jamadilawal", "Jamadilakhir", "Rejab", "Sya'ban",
        "Ramadan", "Syawal", "Zulkaedah", "Zulhijjah"
    ];

    // Adjustable offset for Islamic calendar
    let islamicDateOffset = 0;

    function getIslamicDate(date) {
        // Your getIslamicDate function here
    }

    function checkFirebaseData() {
        db.ref(corsProxy('events')).once('value').then(function(snapshot) {
            console.log('Raw Firebase data:', snapshot.val());
        }).catch(error => {
            console.error('Error fetching Firebase data:', error);
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        checkFirebaseData();
        
        const calendarEl = document.getElementById('calendar');
        if (!calendarEl) {
            console.error('Calendar element not found');
            return;
        }
        
        try {
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                slotMinTime: '08:00:00',
                slotMaxTime: '18:00:00',
                allDaySlot: false,
                selectable: true,
                select: function (info) {
                    selectedDate = info.start;
                    document.getElementById('startTime').value = info.startStr.slice(11, 16);
                    document.getElementById('endTime').value = info.endStr.slice(11, 16);
                    document.getElementById('bookingForm').style.display = 'block';
                },
                eventClick: function (info) {
                    if (confirm(`Do you want to cancel the booking: ${info.event.title}?`)) {
                        db.ref(corsProxy('events/' + info.event.id)).remove().then(() => {
                            info.event.remove();
                            updateAnalytics();
                        });
                    }
                },
                events: function (fetchInfo, successCallback, failureCallback) {
                    db.ref(corsProxy('events')).once('value').then(function (snapshot) {
                        const events = [];
                        snapshot.forEach(function (childSnapshot) {
                            const event = childSnapshot.val();
                            event.id = childSnapshot.key;
                            events.push(event);
                        });
                        console.log('Events loaded:', events);
                        successCallback(events);
                    }).catch(error => {
                        console.error('Error fetching events:', error);
                        failureCallback(error);
                    });
                },
                eventContent: function(arg) {
                    // Your eventContent function here
                },
                dayCellDidMount: function (info) {
                    // Your dayCellDidMount function here
                },
                datesSet: function (info) {
                    // Your datesSet function here
                }
            });
            
            calendar.render();
            console.log('Calendar rendered successfully');
        } catch (error) {
            console.error('Error initializing calendar:', error);
        }

        updateAnalytics();
    });

    function saveBooking() {
        // Your saveBooking function here
    }

    function closeBookingForm() {
        // Your closeBookingForm function here
    }

    function getDepartmentColor(department) {
        // Your getDepartmentColor function here
    }

    function updateAnalytics() {
        db.ref(corsProxy('events')).once('value').then(function(snapshot) {
            // Your updateAnalytics logic here
        });
    }

    function adjustIslamicCalendar(days) {
        // Your adjustIslamicCalendar function here
    }

    // Add buttons to adjust Islamic calendar
    const adjustButtons = `
        <div>
            <button onclick="adjustIslamicCalendar(-2)">-2 Days</button>
            <button onclick="adjustIslamicCalendar(-1)">-1 Day</button>
            <button onclick="adjustIslamicCalendar(1)">+1 Day</button>
            <button onclick="adjustIslamicCalendar(2)">+2 Days</button>
        </div>
    `;
    document.querySelector('.sidebar').insertAdjacentHTML('beforeend', adjustButtons);
    </script>
</body>
</html>
