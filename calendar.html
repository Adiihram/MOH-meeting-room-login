<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPP Meeting Room Booking - Version 4.0</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600&display=swap');
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f7;
            color: #1d1d1f;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 300px;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out;
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .sidebar h2 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }
        #toggleSidebar {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #007aff;
        }
        .analytics-card {
            background-color: #f5f5f7;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .analytics-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .analytics-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .analytics-icon {
            font-size: 20px;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        .analytics-label {
            flex-grow: 1;
            color: #86868b;
        }
        .analytics-value {
            font-weight: 500;
        }
        #main-content {
            flex-grow: 1;
            padding: 20px;
            margin-left: 300px;
        }
        #calendar {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .fc-header-toolbar {
            margin-bottom: 1.5em!important;
        }
        .fc-toolbar-title {
            font-size: 1.5em!important;
            font-weight: 600;
        }
        .fc-button-primary {
            background-color: #007aff!important;
            border-color: #007aff!important;
        }
        .fc-button-primary:hover {
            background-color: #0056b3!important;
        }
        .fc-day-today {
            background-color: #e8f4ff!important;
        }
        .islamic-date {
            font-size: 0.7em;
            color: #86868b;
            text-align: right;
            padding-right: 5px;
        }
        #logoutButton {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #ff3b30;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        .booking-form {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            width: 300px;
        }
        .booking-form input, .booking-form select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
        }
        .booking-form button {
            background-color: #007aff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            margin-top: 10px;
        }
        .booking-form button.cancel {
            background-color: #ff3b30;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            #main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Analytics</h2>
                <button id="toggleSidebar">‚â°</button>
            </div>
            <div class="analytics-card">
                <h3>Bookings</h3>
                <div class="analytics-item">
                    <span class="analytics-icon">üìÖ</span>
                    <span class="analytics-label">Daily</span>
                    <span id="dailyBookings" class="analytics-value">0</span>
                </div>
                <div class="analytics-item">
                    <span class="analytics-icon">üìÜ</span>
                    <span class="analytics-label">Weekly</span>
                    <span id="weeklyBookings" class="analytics-value">0</span>
                </div>
                <div class="analytics-item">
                    <span class="analytics-icon">üìÖ</span>
                    <span class="analytics-label">Monthly</span>
                    <span id="monthlyBookings" class="analytics-value">0</span>
                </div>
            </div>
            <div class="analytics-card">
                <h3>Hours Booked</h3>
                <div class="analytics-item">
                    <span class="analytics-icon">‚è±Ô∏è</span>
                    <span class="analytics-label">Daily</span>
                    <span id="dailyHours" class="analytics-value">0</span>
                </div>
                <div class="analytics-item">
                    <span class="analytics-icon">‚è±Ô∏è</span>
                    <span class="analytics-label">Weekly</span>
                    <span id="weeklyHours" class="analytics-value">0</span>
                </div>
                <div class="analytics-item">
                    <span class="analytics-icon">‚è±Ô∏è</span>
                    <span class="analytics-label">Monthly</span>
                    <span id="monthlyHours" class="analytics-value">0</span>
                </div>
            </div>
            <div class="analytics-card">
                <h3>Availability</h3>
                <div class="analytics-item">
                    <span class="analytics-icon">üìä</span>
                    <span class="analytics-label">Vacant Days</span>
                    <span id="vacantDays" class="analytics-value">0</span>
                </div>
                <div class="analytics-item">
                    <span class="analytics-icon">üìä</span>
                    <span class="analytics-label">Vacant Hours</span>
                    <span id="vacantHours" class="analytics-value">0</span>
                </div>
            </div>
        </div>
        <div id="main-content">
            <h1>DPP Meeting Room Booking - Version 4.0</h1>
            <div id="calendar"></div>
        </div>
    </div>
    <button id="logoutButton">Logout</button>

    <div id="bookingForm" class="booking-form">
        <input type="text" id="meetingTitle" placeholder="Meeting Title">
        <select id="department">
            <option value="">Select Department</option>
            <option value="Department of Medical Services">Department of Medical Services</option>
            <option value="Department of Public Health">Department of Public Health</option>
            <option value="Department of Health Technology">Department of Health Technology</option>
            <option value="Department of Research and Development">Department of Research and Development</option>
            <option value="Department of Health Regulation">Department of Health Regulation</option>
        </select>
        <button onclick="saveBooking()">Save Booking</button>
        <button onclick="closeBookingForm()" class="cancel">Cancel</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAED2NeWY224WpucUIFIef6Ekm7lUufM0o",
            authDomain: "moh-meeting-room-booking.firebaseapp.com",
            databaseURL: "https://moh-meeting-room-booking-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "moh-meeting-room-booking",
            storageBucket: "moh-meeting-room-booking.appspot.com",
            messagingSenderId: "629503206549",
            appId: "1:629503206549:web:4b172b7f392b7aef0de79c",
            measurementId: "G-MDSDN8ZS5F"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let calendar;
        let selectedStart, selectedEnd;

        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                selectable: true,
                select: function(info) {
                    selectedStart = info.start;
                    selectedEnd = info.end;
                    document.getElementById('bookingForm').style.display = 'block';
                },
                eventClick: function(info) {
                    // Handle event click (edit/delete functionality can be added here)
                },
                events: function(fetchInfo, successCallback, failureCallback) {
                    db.ref('events').once('value').then(function(snapshot) {
                        const events = [];
                        snapshot.forEach(function(childSnapshot) {
                            const event = childSnapshot.val();
                            event.id = childSnapshot.key;
                            events.push(event);
                        });
                        successCallback(events);
                    }).catch(failureCallback);
                },
                dayCellDidMount: function(info) {
                    getIslamicDate(info.date).then(islamicDate => {
                        const element = info.el.querySelector('.fc-daygrid-day-top');
                        if (element) {
                            const islamicDateElement = document.createElement('div');
                            islamicDateElement.className = 'islamic-date';
                            islamicDateElement.textContent = islamicDate;
                            element.appendChild(islamicDateElement);
                        }
                    });
                }
            });
            calendar.render();
            updateAnalytics();
        });

        async function getIslamicDate(date) {
            const gregDate = date.toISOString().split('T')[0];  // Format: YYYY-MM-DD
            try {
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${gregDate}`);
                const data = await response.json();
                const hijri = data.data.hijri;
                return `${hijri.day} ${hijri.month.en}`;  // Returning day and month only
            } catch (error) {
                console.error('Error fetching Islamic date:', error);
                return '';
            }
        }

        function saveBooking() {
            const title = document.getElementById('meetingTitle').value;
            const department = document.getElementById('department').value;
            if (title && department) {
                const newEvent = {
                    title: `${title} - ${department}`,
                    start: selectedStart,
                    end: selectedEnd,
                    allDay: false,
                    color: getDepartmentColor(department)
                };
                db.ref('events').push(newEvent).then(function(ref) {
                    calendar.addEvent(newEvent);
                    closeBookingForm();
                    updateAnalytics();
                });
            }
        }

        function closeBookingForm() {
            document.getElementById('bookingForm').style.display = 'none';
            document.getElementById('meetingTitle').value = '';
            document.getElementById('department').value = '';
        }

        function getDepartmentColor(department) {
            const colors = {
                'Department of Medical Services': '#007AFF',
                'Department of Public Health': '#34C759',
                'Department of Health Technology': '#FF3B30',
                'Department of Research and Development': '#FF9500',
                'Department of Health Regulation': '#5856D6'
            };
            return colors[department] || '#8E8E93';
        }

        function updateAnalytics() {
            // Implement analytics update logic here
            // This function should fetch data from Firebase and update the sidebar
        }

        document.getElementById('logoutButton').addEventListener('click', function() {
            // Implement logout logic here
            window.location.href = "/index.html";
        });

        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
        });
    </script>
</body>
</html>
