<script>
    console.log("Script Loaded");

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAED2NeWY224WpucUIFIef6Ekm7lUufM0o",
        authDomain: "moh-meeting-room-booking.firebaseapp.com",
        databaseURL: "https://moh-meeting-room-booking-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "moh-meeting-room-booking",
        storageBucket: "moh-meeting-room-booking.appspot.com",
        messagingSenderId: "629503206549",
        appId: "1:629503206549:web:4b172b7f392b7aef0de79c",
        measurementId: "G-MDSDN8ZS5F"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Initialize Realtime Database
    const db = firebase.database();
    console.log("Firebase Initialized");

    // Auth0 Configuration
    const auth0 = new auth0.WebAuth({
        domain: 'dev-tpwyh6hlgc15eq8h.us.auth0.com',
        clientID: 'cLBQYcrc1mZjkZx8uG7WQdLgkGWEgoo9',
        redirectUri: 'https://adiihram.github.io/MOH-meeting-room-login/',
        responseType: 'token id_token',
        scope: 'openid profile email'
    });

    // Define login and logout functions in the global scope
    window.login = function() {
        console.log("Login button clicked");
        auth0.authorize();
    }

    window.logout = function() {
        console.log("Logout button clicked");
        auth0.logout({
            returnTo: window.location.href
        });
        document.getElementById('calendar').style.display = 'none';
        document.getElementById('printButton').style.display = 'none';
    }

    // Rest of your functions...
    function handleAuthentication() {
        console.log("Handling Authentication");
        auth0.parseHash(function(err, authResult) {
            if (authResult && authResult.accessToken && authResult.idToken) {
                console.log("Authentication successful");
                window.location.hash = '';
                setSession(authResult);
                document.getElementById('login').style.display = 'none';
                document.getElementById('logout').style.display = 'block';
                document.getElementById('printButton').style.display = 'block';
                loadCalendar(authResult.idTokenPayload.sub);
            } else if (err) {
                console.log('Authentication error:', err);
                alert('Error: ' + err.errorDescription);
            } else {
                console.log("Authentication failed");
                document.getElementById('login').style.display = 'block';
            }
        });
    }

    function setSession(authResult) {
        console.log("Setting session");
        const expiresAt = JSON.stringify((authResult.expiresIn * 1000) + new Date().getTime());
        localStorage.setItem('access_token', authResult.accessToken);
        localStorage.setItem('id_token', authResult.idToken);
        localStorage.setItem('expires_at', expiresAt);
        console.log('Session set with authResult:', authResult);
    }

    function isAuthenticated() {
        console.log("Checking authentication status");
        const expiresAt = JSON.parse(localStorage.getItem('expires_at'));
        const isAuth = new Date().getTime() < expiresAt;
        console.log('Is authenticated:', isAuth);
        return isAuth;
    }

    // ... (rest of your functions)

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded');
        
        handleAuthentication();
        
        if (isAuthenticated()) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('logout').style.display = 'block';
            document.getElementById('printButton').style.display = 'block';
            loadCalendar(localStorage.getItem('id_token'));
        } else {
            console.log('User is not authenticated, showing login button.');
            document.getElementById('calendar').style.display = 'none';
            document.getElementById('login').style.display = 'block';
        }
    });
</script>
