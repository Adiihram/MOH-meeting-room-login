<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPP Meeting Room Booking v2.6</title>
    <script src="https://cdn.auth0.com/js/auth0/9.13/auth0.min.js"></script>
    <style>
        /* ... (styles remain the same) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>DPP Meeting Room v2.6</h1>
        <div id="maze"></div>
        <button id="loginButton">Login</button>
    </div>
    <script>
        var auth0Client = null;
        var maze, pacman, ghosts;
        var mazeLayout = [
            "WWWWWWWWWWWWWWWWWWWW",
            "W..................W",
            "W.WWWW.WWWW.WWWW.W.W",
            "W.W....W....W....W.W",
            "W.W.WW.W.WW.W.WW.W.W",
            "W.W....W....W....W.W",
            "W.WWWW.WWWW.WWWW.W.W",
            "W..................W",
            "WWWWWWWWWWWWWWWWWWWW"
        ];
        var cellSize;
        var lastMove = 0;
        var moveInterval = 200;

        // ... (other functions remain the same) ...

        function createMaze() {
            // ... (maze creation code remains the same) ...

            ghosts = [];
            for (let i = 1; i <= 3; i++) {
                const ghost = document.createElement('div');
                ghost.id = `ghost${i}`;
                ghost.className = 'ghost';
                maze.appendChild(ghost);
                ghosts.push(ghost);
            }

            positionCharacters();
        }

        function moveCharacter(character) {
            const directions = [[0, -1], [0, 1], [-1, 0], [1, 0]];
            const currentX = Math.floor(parseInt(character.style.left) / cellSize);
            const currentY = Math.floor(parseInt(character.style.top) / cellSize);

            const validDirections = directions.filter(([dx, dy]) => {
                const newX = currentX + dx;
                const newY = currentY + dy;
                return newX >= 0 && newX < mazeLayout[0].length && newY >= 0 && newY < mazeLayout.length && mazeLayout[newY][newX] !== 'W';
            });

            if (validDirections.length > 0) {
                const [dx, dy] = validDirections[Math.floor(Math.random() * validDirections.length)];
                const newX = currentX + dx;
                const newY = currentY + dy;
                character.style.left = `${newX * cellSize}px`;
                character.style.top = `${newY * cellSize}px`;
            }
        }

        function checkCollisions() {
            const pacmanRect = pacman.getBoundingClientRect();
            ghosts.forEach((ghost, index) => {
                if (ghost.style.display !== 'none') {
                    const ghostRect = ghost.getBoundingClientRect();
                    if (pacmanRect.left < ghostRect.right && 
                        pacmanRect.right > ghostRect.left && 
                        pacmanRect.top < ghostRect.bottom && 
                        pacmanRect.bottom > ghostRect.top) {
                        ghost.style.display = 'none';
                        console.log(`Ghost ${index + 1} caught!`);
                        if (ghosts.every(g => g.style.display === 'none')) {
                            console.log("All ghosts caught, resetting game");
                            setTimeout(resetGame, 1000);
                        }
                    }
                }
            });
        }

        function resetGame() {
            console.log("Resetting game");
            ghosts.forEach(ghost => {
                ghost.style.display = 'block';
            });
            positionCharacters();
        }

        function animateFrame(timestamp) {
            if (timestamp - lastMove > moveInterval) {
                moveCharacter(pacman);
                ghosts.forEach(ghost => {
                    if (ghost.style.display !== 'none') {
                        moveCharacter(ghost);
                    }
                });
                checkCollisions();
                lastMove = timestamp;
            }
            requestAnimationFrame(animateFrame);
        }

        window.onload = function() {
            initializeAuth0();
            createMaze();
            requestAnimationFrame(animateFrame);
            document.getElementById('loginButton').addEventListener('click', function() {
                auth0Client.authorize();
            });
        };
    </script>
</body>
</html>
