document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var departments = [
        'Department of Medical Services',
        'Department of Public Health',
        'Department of Health Technology',
        'Department of Research and Development',
        'Department of Health Regulation',
        // Add other departments as needed
    ];

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        selectable: true,
        editable: true, // Allows events to be edited or deleted
        select: function(info) {
            var title = prompt('Enter Meeting Title:');
            
            // Create a dropdown for department selection
            if (title) {
                var department = promptDepartmentSelection(departments);
                if (department) {
                    var booking = {
                        date: info.startStr,
                        startTime: info.startStr,
                        endTime: info.endStr,
                        title: title,
                        department: department,
                        user: 'User Name' // Replace with actual user information
                    };

                    // Send booking to Google Sheets
                    fetch('YOUR_WEB_APP_URL', { // Replace with your Google Apps Script Web App URL
                        method: 'POST',
                        body: JSON.stringify(booking)
                    })
                    .then(response => response.text())
                    .then(bookingId => {
                        calendar.addEvent({
                            id: bookingId,
                            title: title,
                            start: info.startStr,
                            end: info.endStr,
                            allDay: info.allDay
                        });
                        alert('Meeting booked on ' + info.startStr);
                    })
                    .catch(error => console.error('Error:', error));
                }
            }
            calendar.unselect();
        },
        eventClick: function(info) {
            if (confirm("Do you want to cancel this booking?")) {
                var bookingId = info.event.id;

                // Send delete request to Google Sheets
                fetch('YOUR_DELETE_WEB_APP_URL', { // Replace with your Google Apps Script Web App URL for deletion
                    method: 'POST',
                    body: JSON.stringify({ bookingId: bookingId })
                })
                .then(response => response.text())
                .then(result => {
                    if (result === 'Success') {
                        info.event.remove(); // Remove event from calendar
                        alert('Booking cancelled.');
                    } else {
                        alert('Failed to cancel booking: ' + result);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }
    });
    calendar.render();

    function promptDepartmentSelection(departments) {
        var departmentList = departments.map((dept, index) => `${index + 1}. ${dept}`).join('\n');
        var selection = prompt(`Select Department:\n${departmentList}`);
        var index = parseInt(selection) - 1;
        return departments[index] || null;
    }
});         
